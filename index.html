<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דף נחיתה לפודקאסט - פרק 3</title>
    <link rel="stylesheet" href="styles.css">
    </head>
<body dir="rtl">
    <div class="container">
        <div>
            <h1>פודקאסט SLICED </h1>
            <h1>על פיקוד במילואים</h1>
            <hr>
            <h2>כינוס קודקודים</h2>
            <h3>פרק 3 - מה שאתה עושה בשגרה זה מה שאתה עושה בחירום</h3>
            <div class="bottom">
                <center>
                    <!-- Updated the iframe src to include autoplay and mute parameters -->
                    <iframe id="player" width="370" height="208" src="https://www.youtube.com/embed/k5oWo5L-faM?enablejsapi=1&autoplay=1&mute=1" title="YouTube video player" frameborder="0" allowfullscreen></iframe>
                </center>
            </div>
            <div class="grid">
                <!-- Your existing sections -->
                <!-- ... (sections remain unchanged) ... -->
            </div>
        </div>
    </div>

    <!-- Load YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let updateInterval = null;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                },
                playerVars: {
                    autoplay: 1, // Attempt to autoplay the video
                    mute: 1      // Mute the video to comply with autoplay policies
                }
            });
        }

        function onPlayerReady(event) {
            // Unmute the video if you want sound after user interaction
            // player.unMute();

            const sectionLinks = document.querySelectorAll('.box');
            sectionLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default behavior
                    const startTime = parseFloat(link.getAttribute('data-start'));
                    player.seekTo(startTime, true);
                    player.playVideo();
                });
                // Make the div focusable and accessible
                link.setAttribute('tabindex', '0');
                link.setAttribute('role', 'button');
                link.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        link.click();
                    }
                });
            });
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                if (!updateInterval) {
                    updateActiveSection(); // Initial check
                    updateInterval = setInterval(updateActiveSection, 1000);
                }
            } else {
                if (updateInterval) {
                    clearInterval(updateInterval);
                    updateInterval = null;
                }
            }
        }

        function updateActiveSection() {
            try {
                const currentTime = player.getCurrentTime();
                const sections = document.querySelectorAll('.box');
                let activeFound = false;
                sections.forEach(section => {
                    const start = parseFloat(section.getAttribute('data-start'));
                    const end = parseFloat(section.getAttribute('data-end'));
                    if (currentTime >= start && currentTime < end) {
                        section.classList.add('active');
                        activeFound = true;
                    } else {
                        section.classList.remove('active');
                    }
                });
                // If no active section is found and the video has ended, highlight the last section
                if (!activeFound && player.getPlayerState() === YT.PlayerState.ENDED) {
                    sections[sections.length - 1].classList.add('active');
                }
            } catch (error) {
                console.error('Error updating active section:', error);
            }
        }
    </script>
</body>
</html>
